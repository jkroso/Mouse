/*! Mouse - v0.1.0 - 2012-10-05
* https://github.com/jkroso/Mouse
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define("Button",[],function(){function e(e){this.lastDown={timeStamp:0,x:0,y:0},this.lastUp=this.lastDown,this.last=this.lastDown,this.down=!1,this.dragging=!1,this.name=e}return e.prototype={constructor:e,onDown:function(e){e.target===this.lastDown.target&&e.timeStamp-this.lastDown.timeStamp<350?e.types=["double",this.name]:e.types=["down",this.name],this.lastActivity=e.timeStamp,this.down=!0,this.last=this.lastDown=e,e.name="down."+this.name},onUp:function(e){if(this.dragging){this.dragging=!1;var t=new CustomEvent("l",{bubbles:!0,cancelable:!0});t.x=e.x,t.y=e.y,t.types=["drop",this.name],t.name="drop."+this.name,this.lastDown.target.dispatchEvent(t),e.stopPropagation(),e.stopImmediatePropagation()}else e.target===this.lastDown.target&&e.timeStamp-this.lastDown.timeStamp<350?e.types=[["click",[this.name]]]:e.types=[["up",[this.name]]];return this.down=!1,this.last=this.lastUp=e,e.name="up."+this.name,t||e},onMove:function(e){var t;this.dragging||(this.dragging=!0,t=new Event("l",{bubbles:!0,cancelable:!0}),t.x=this.lastDown.x,t.y=this.lastDown.y,t.types=["grab",this.name],t.name="grab."+this.name,this.lastDown.target.dispatchEvent(t)),t=new Event("l",{bubbles:!0,cancelable:!0}),t.types=["drag",this.name],t.movementX=e.movementX,t.movementY=e.movementY,t.deltaX=(t.x=e.x)-this.last.x,t.deltaY=(t.y=e.y)-this.last.y,t.totalX=e.x-this.lastDown.x,t.totalY=e.y-this.lastDown.y,t.name="drag."+this.name,this.lastDown.target.dispatchEvent(t),e.stopPropagation(),e.stopImmediatePropagation()}},e}),define("Mouse",["Button"],function(e){function n(n){var r=this;this.view=n,this.x=0,this.y=0,this[1]=new e("left"),this[2]=new e("middle"),this[3]=new e("left+middle"),this[4]=new e("right"),this[5]=new e("left+right"),this[6]=new e("middle+right"),this[7]=new e("left+middle+right"),this.down=null,this.buttons=0,this.lastActivity=Date.now(),this.last=undefined,Object.defineProperties(this,{_beforeMove:{value:new Array,writable:!0},_beforeDrag:{value:new Array,writable:!0}});var i={click:function(e){e.preventDefault()},mousedown:function(e){r.down&&(e.previousDown=r.down),r.down=e,r.buttons+=t[e.button],r[r.buttons].onDown(e),r.update(e)},mouseup:function(e){var n=r.down;if(n.which===e.which)r.down=n.previousDown;else do if(n.previousDown.which===e.which){n.previousDown=n.previousDown.previousDown;break}while(n=n.previousDown);r[r.buttons].onUp(e),r.buttons-=t[e.button],r.update(e)},mousemove:function(e){e.movementX=e.webkitMovementX,e.movementY=e.webkitMovementY;if(e.movementX||e.movementY){if(r.buttons)r[r.buttons].onMove(e);else{var t,n=["move"];e.movementY>0?n.push(["up"]):e.movementY<0&&n.push(["down"]),e.movementX>0?n.push(["right"]):e.movementX<0&&n.push(["left"]),e.types=[n],e.branching=!0;if(t=r._beforeMove.length){n=r._beforeMove;do n[--t](e,r);while(t)}}r.x=e.x,r.y=e.y,r.update(e)}else e.stopPropagation(),e.stopImmediatePropagation()},mousewheel:function(e){e.wheelDelta>0?e.types=[["wheel",["up"]]]:e.types=[["wheel",["down"]]],e.wheelDeltaX>0?e.types[0].push(["left"]):e.wheelDeltaX<0&&e.types[0].push(["right"]),r.update(e)},mouseover:function(e){e.relatedTarget===null&&(r.active=!0,r.update(e)),e.types=["over"],e.name="over"},mouseout:function(e){e.relatedTarget===null&&(r.active=!1,r.update(e)),e.types=["out"],e.name="out"}};Object.keys(i).forEach(function(e){n.addEventListener(e,i[e],!0)})}function r(e){var t=[e.name];while(e.previous)e=e.previous,t.unshift(e.name);return t.join(",")}var t=Object.freeze([1,2,4]);return n.prototype={constructor:n,sequence:function(e){e.timeStamp-this.lastActivity<350&&(e.previous=this.last,e.types.push([r(e)]))},update:function(e){this.last=e,this.lastActivity=e.timeStamp},addAspect:function(e,t){var n;if(typeof t!="function")throw"action must be a function";switch(e){case"move":n=this._beforeMove=this._beforeMove.slice();break;case"drag":n=this._beforeDrag=this._beforeDrag.slice()}return n.unshift(t)},removeAspect:function(e,t){var n;switch(e){case"move":n=this._beforeMove.filter(function(e){return e===t||e.name===t});break;case"drag":n=this._beforeDrag.filter(function(e){return e===t||e.name===t})}return n.length}},n.call(n,window),Object.keys(n.prototype).forEach(function(e){Object.defineProperty(n,e,{value:n.prototype[e]}),Object.defineProperty(n.prototype,e,{enumerable:!1})}),typeof Window!="undefined"&&(Window.prototype.Mouse=n),n});